<!DOCTYPE html>
<html lang="ja">
<head>
  <script src="event-config.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ã”ã»ã†ã³</title>
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'DotGothic16', sans-serif;
      text-align: center;
      padding: 30px 10px;
      background-color: #f3fff5;
    }
    h1{margin:0 0 14px;}
    img{
      max-width: 92%;
      border: 4px solid #2ecc71;
      border-radius: 12px;
      margin: 10px 0 16px;
    }
    .btn{
      margin-top: 8px;
      padding: 14px 22px;
      font-size: 18px;
      border: none;
      border-radius: 10px;
      background-color: #2ecc71;
      color: white;
      cursor: pointer;
      font-weight: 800;
      width: 90%;
      max-width: 380px;
    }
    .btn:hover { background-color: #27ae60; }
    .btn.sub{
      background: #fff;
      color: #27ae60;
      border: 2px solid #27ae60;
    }
    .btn.sub:hover{ background: #eafff0; }
    .muted{color:#555; font-size: 14px; margin-top: 10px; white-space: pre-line;}
  </style>
</head>
<body>
  <h1 id="title">ğŸ ã”ã»ã†ã³</h1>
  <p class="muted" id="sub">èª­ã¿è¾¼ã¿ä¸­...</p>

  <img id="goalImg" src="images/goal.png" alt="å®Œæˆç”»åƒ" />

  <button class="btn" id="confirmBtn">ã‚¹ã‚¿ãƒƒãƒ•ç¢ºèªã«é€²ã‚€</button>
  <button class="btn sub" id="menuBtn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸æˆ»ã‚‹</button>

  <script>
    const mode = localStorage.getItem('mode') || 'family';
    const isChallenge = (mode === 'challenge');
    const total = isChallenge ? 9 : 4;
    const pieceKey = (n) => isChallenge ? `c_piece${n}` : `piece${n}`;

    const unlockKey = isChallenge ? 'reward_unlocked_challenge' : 'reward_unlocked_family';
    const confirmKey = isChallenge ? 'confirmed_challenge' : 'confirmed_family';

    const menuHref = isChallenge ? 'start_challenge.html' : 'start.html';
    document.getElementById('menuBtn').onclick = () => location.href = menuHref;

    // ç”»åƒåˆ‡æ›¿ï¼ˆãƒãƒ£ãƒ¬ãƒ³ã‚¸ã¯ä»Šå›ã®å†™çœŸï¼‰
    document.getElementById('goalImg').src = isChallenge ? 'images/challenge/goal.png' : 'images/goal.png';

    const titleEl = document.getElementById('title');
    const subEl = document.getElementById('sub');

    // ç›´ãƒªãƒ³ã‚¯å¯¾ç­–ï¼šintroã§unlockã—ã¦ã„ãªã„å ´åˆã¯æˆ»ã™
    if (localStorage.getItem(unlockKey) !== 'true') {
      titleEl.textContent = 'ğŸ”’ ã”ã»ã†ã³ã¯ ã¾ã  ã²ã¿ã¤';
      subEl.textContent = 'ã”ã»ã†ã³ã‚’è¦‹ã‚‹ã«ã¯ã€ã„ã£ãŸã‚“ã€Œã”ã»ã†ã³ ã¾ãˆãŒãã€ãƒšãƒ¼ã‚¸ã‚’é€šã£ã¦ã­ã€‚';
      document.getElementById('confirmBtn').style.display = 'none';
      return;
    }

    // å®Œäº†ãƒã‚§ãƒƒã‚¯
    const got = Array.from({length: total}, (_, i) => localStorage.getItem(pieceKey(i+1)) === 'true');
    const done = got.every(Boolean);
    if (!done) {
      titleEl.textContent = 'ã¾ã  ãã‚ã£ã¦ã„ãªã„ï¼';
      subEl.textContent = 'ãƒ”ãƒ¼ã‚¹ãŒè¶³ã‚Šãªã„ã‚ˆã†ã§ã™ã€‚é€²è¡ŒçŠ¶æ³ã‹ã‚‰ç¢ºèªã—ã¦ãã ã•ã„ã€‚';
      document.getElementById('confirmBtn').style.display = 'none';
      return;
    }

    titleEl.textContent = 'ğŸ‰ ã‹ã‚“ã›ã„ï¼';
    subEl.textContent = isChallenge
      ? 'ãƒãƒ£ãƒ¬ãƒ³ã‚¸ï¼ˆ9ãƒ”ãƒ¼ã‚¹ï¼‰ã‚¯ãƒªã‚¢ï¼\næœ¬éƒ¨ã§ã‚¹ã‚¿ãƒƒãƒ•ã«è¦‹ã›ã¦ãã ã•ã„ã€‚'
      : 'ãƒ•ã‚¡ãƒŸãƒªãƒ¼ï¼ˆ4ãƒ”ãƒ¼ã‚¹ï¼‰ã‚¯ãƒªã‚¢ï¼\næœ¬éƒ¨ã§ã‚¹ã‚¿ãƒƒãƒ•ã«è¦‹ã›ã¦ãã ã•ã„ã€‚';

    document.getElementById('confirmBtn').onclick = () => {
      // äºŒé‡äº¤ä»˜é˜²æ­¢ã®å°ï¼ˆæœ¬ç•ªã®é‹ç”¨ã«åˆã‚ã›ã¦èª¿æ•´OKï¼‰
      localStorage.setItem(confirmKey, 'pending');
      location.href = 'admin/verify.html';
    };
  </script>
</body>
</html>
