<!DOCTYPE html>
<html lang="ja">
<head>
  <script src="event-config.js"></script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ç¢ºèªå®Œäº†</title>
  <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'DotGothic16', sans-serif;
      text-align: center;
      padding: 40px 20px;
      background-color: #f0fff4;
      margin: 0;
    }
    h1 {
      font-size: 2.0rem;
      color: #2e7d32;
      margin: 0 0 10px;
    }
    p {
      font-size: 1.1rem;
      margin: 0 0 24px;
      color: #444;
      line-height: 1.8;
    }
    .btn {
      padding: 12px 20px;
      font-size: 1.0rem;
      background-color: #4caf50;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      width: 92%;
      max-width: 320px;
      font-weight: 800;
    }
  </style>

  <script>
  (function(){
    const lang = localStorage.getItem("lang") || "";
    const reg  = localStorage.getItem("app_registered") === "true";
    if(!lang){ location.replace("language.html"); return; }
    if(!reg){ location.replace("register.html"); return; }
  })();
  </script>

</head>
<body>
  <h1>âœ… ç¢ºèªå®Œäº†ï¼</h1>
  <p id="msg">æœ¬éƒ¨ã§ç¢ºèªæ¸ˆã¿ã«ã—ã¾ã—ãŸã€‚<br>ç”»é¢ã‚’é–‰ã˜ã‚‹ã‹ã€ãƒ›ãƒ¼ãƒ ã¸æˆ»ã£ã¦ãã ã•ã„ã€‚</p>
  <button class="btn" onclick="finish()">ğŸ ãƒ›ãƒ¼ãƒ ã¸æˆ»ã‚‹</button>

  <script>
    const mode = localStorage.getItem('mode') || 'family';
    const confirmedKey = (mode === 'challenge') ? 'confirmed_challenge' : 'confirmed_family';
    const rewardKey = (mode === 'challenge') ? 'reward_unlocked_challenge' : 'reward_unlocked_family';
    const visitedKey = (mode === 'challenge') ? 'visitedIntro_challenge' : 'visitedIntro_family';

    // âœ… æœ¬éƒ¨ç¢ºèªæ¸ˆã¿ãƒ•ãƒ©ã‚°
    localStorage.setItem(confirmedKey, 'true');

    function finish(){
      // å®Œäº†å¾Œã¯ã€åŒã˜ç«¯æœ«ã§å†å‚åŠ ã§ãã‚‹ã‚ˆã†ã«ã€Œã“ã®ãƒ¢ãƒ¼ãƒ‰ã®é€²æ—ã€ã ã‘æ¶ˆã™
      if(mode === 'challenge'){
        for(let i=1;i<=9;i++) localStorage.removeItem(`c_piece${i}`);
      } else {
        for(let i=1;i<=4;i++) localStorage.removeItem(`piece${i}`);
      }
      localStorage.removeItem(rewardKey);
      localStorage.removeItem(visitedKey);

      // æ¬¡ã®å‚åŠ è€…ã®ãŸã‚ã«ã€confirmed ã¯ä¸€æ—¦æ¶ˆã™ï¼ˆæœ¬éƒ¨å´ã§ã®äºŒé‡ç¢ºèªé˜²æ­¢ã¯ verify.html å´ã§è¡Œã†æƒ³å®šï¼‰
      // â€»ã€Œç¢ºèªæ¸ˆã¿è¡¨ç¤ºã‚’æ®‹ã—ãŸã„ã€å ´åˆã¯ã“ã®1è¡Œã‚’æ¶ˆã—ã¦ãã ã•ã„
      localStorage.removeItem(confirmedKey);

      window.location.href = 'index.html';
    }
  </script>
</body>
</html>
