<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ— - SakuLink</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="header-bar">
    <div class="header-inner">
      <div class="logo">ğŸŒ¸ SakuLink ğŸŒ¸</div>
      <div class="menu-button" onclick="toggleMenu()">ğŸ“– MENU â˜°</div>
    </div>
  </div>
  <div class="menu" id="menu">
    <ul>
      <li><a href="index.html">ğŸ  ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a></li>
      <li><a href="login.html">ğŸ” ãƒ­ã‚°ã‚¤ãƒ³</a></li>
    </ul>
  </div>

  <main>
    <h2>ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—</h2>
    <form id="signup-form">
      <label for="name">åå‰:</label>
      <input type="text" id="name" required><br>

      <label for="email">ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label>
      <input type="email" id="email" required><br>

      <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰:</label>
      <input type="password" id="password" required><br>

      <button type="submit">ç™»éŒ²</button>
    </form>
  </main>

  <script>
    function toggleMenu() {
      const menu = document.getElementById("menu");
      menu.classList.toggle("show");
    }

    document.getElementById("signup-form").addEventListener("submit", async function (e) {
      e.preventDefault();

      const name = document.getElementById("name").value.trim();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value;

      if (!name || !email || !password) {
        alert("ã™ã¹ã¦ã®é …ç›®ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
        return;
      }

      try {
        // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®é‡è¤‡ãƒã‚§ãƒƒã‚¯
        const checkRes = await fetch("https://x8ki-letl-twmt.n7.xano.io/api:W-9gWuwf/auth/check_email", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email }),
        });

        const checkData = await checkRes.json();

        if (checkData.message === "DUPLICATE") {
          alert("ã“ã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã¯ã™ã§ã«ç™»éŒ²ã•ã‚Œã¦ã„ã¾ã™ã€‚");
          return;
        }

        if (checkData.message !== "OK") {
          alert("ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®ç¢ºèªä¸­ã«å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
          return;
        }

        // ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†
        const signupRes = await fetch("https://x8ki-letl-twmt.n7.xano.io/api:W-9gWuwf/auth/signup", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, email, password }),
        });

        if (!signupRes.ok) {
          alert("ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸã€‚");
          return;
        }

        alert("ç™»éŒ²ãŒå®Œäº†ã—ã¾ã—ãŸï¼ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ã«ç§»å‹•ã—ã¾ã™ã€‚");
        window.location.href = "login.html";

      } catch (error) {
        console.error(error);
        alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚");
      }
    });
  </script>
</body>
</html>
